<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-GB">
<head profile="http://gmpg.org/xfn/11">
	<title>tom bh</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="google-site-verification" content="Me_DN7gOhDhF0PNu5ALBSOd-_362oOMSMAQXOFmEuXI" />

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	
	<link rel="stylesheet" type="text/css" href="/css/style.css" />
	<link rel="stylesheet" type="text/css" href="/css/pygments.css" />
	
	<link rel="icon" href="/images/favicon.png" type="image/png" />

</head>


	<body class="blog">


	<div class="wrapper">

		<div class="header_wrap">
			<a class="header" href="/" title="tom bh" rel="home">
				<div class="blog-title">
					<span>
						<img class="heart_logo" src="/images/heart_logo.png" width="100" alt="Watercolour Heart Logo" />
						tom bh
					</span>
				</div>
				<div class="blog-description">#Web Developer<br />#Meditator</div>
			</a>


			<div class="menu">
				<ul>
					<li>
						<a href="/blog" class="blog">Blog</a>
					</li>
					<li>
						<a href="/about" class="about">About</a>
					</li>
					<li>
						<a href="/showcase" class="showcase">Showcase</a>
					</li>
					<li>
						<a href="http://twitter.com/twombh" target="_blank"><img src="/images/twitter.png" alt="Follow me on Twitter" /></a>
					</li>
				</ul>
			</div>
			<div style="clear:both"></div>

		</div>

		<div style="clear:both"></div>

		<div classs="container">
			<div class="content">

				<h1>HTML Parsing and DIY RSS feeds</h1>

<span class="post_date">20 June 2008</span>

<p>A PHP library that I think more people should know about is SC Chen's <a href="http://simplehtmldom.sourceforge.net/">Simple HTML DOM Parser</a>.</p>

<p>An HTML parser is a very powerful tool that allows the systematic 'reading' (i.e. parsing) of an HTML document so that specific elements can be accessed. One example of this would be to regularly parse a forum thread in order to extract the text of the conversation so that it can be published in an RSS feed.</p>

<p>Right, let's say we've managed to get our chosen HTML document into a variable called <code>$dom</code> -- we can then do stuff like this;</p>

<pre><code>foreach($dom-&gt;**find**('img') as $element) echo $element-&gt;**src** . '&lt;br&gt;';
</code></pre>

<p>What that does is first build an array of all the <code>&lt;img&gt;</code> tags (and their various attributes such src, alt, width, height) in the document, then, the foreach loop iterates through each <code>&lt;img&gt;</code> tag and outputs its <code>src</code> attribute.</p>

<p>The <code>find()</code> function actually has 2 arguments, the first being the name of the tag you want to find, as demonstrated, and the second can be used to pinpoint a particular tag by numerical order. For example to find the first <code>&lt;div&gt;</code> element the code would be <code>find('div', 0)</code>, remembering that arrays begin with 0 not 1.</p>

<p>Perhaps the most important attribute that can be accessed is the <code>innerHTML</code> one, which you'd do like this;</p>

<pre><code>$element =  find('div', 0);
$innerHTML = $element-&gt;innerHTML;
</code></pre>

<p>So as you can see, HTML parsing is a very useful and accessible way of getting at any part of a HTML document. Obviously I've only been able outline the basics here, there are of course a lot more useful functions in Chen's library.</p>

<p>So if you want to use the HTML parser to create RSS feeds, first you'll need an RSS creator library like <a href="http://www.bitfolge.de/rsscreator-en.html">bitfolge's Feed Creator Class</a>. You can then get all the data for your RSS feeds (like title and description) ready with the HTML parser then add them to the RSS code. Here is the heart of some code I currently use to make feeds;</p>

<div class="highlight"><pre><code class="language-perl" data-lang="perl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$dom</span><span class="o">-&gt;</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;table.forumline tr&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="nv">$table_row</span><span class="p">){</span>
    <span class="sr">//</span><span class="n">Filter</span> <span class="n">off</span> <span class="n">irrelvant</span> <span class="n">table</span> <span class="n">rows</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$table_row</span><span class="o">-&gt;</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;td span.topictitle&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="sr">//</span><span class="n">Filter</span> <span class="n">off</span> <span class="n">sticky</span> <span class="n">threads</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">eregi</span><span class="p">(</span><span class="s">&#39;sticky&#39;</span><span class="p">,</span> <span class="nv">$table_row</span><span class="o">-&gt;</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;td img&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">src</span><span class="p">)</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">eregi</span><span class="p">(</span><span class="s">&#39;announce&#39;</span><span class="p">,</span> <span class="nv">$table_row</span><span class="o">-&gt;</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;td img&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">src</span><span class="p">)</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="sr">//</span><span class="n">Fill</span> <span class="n">her</span> <span class="n">up</span>
    <span class="nv">$item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FeedItem</span><span class="p">();</span>
    <span class="nv">$title</span> <span class="o">=</span> <span class="n">trim</span><span class="p">(</span><span class="nv">$table_row</span><span class="o">-&gt;</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;span.topictitle a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">plaintext</span><span class="p">);</span>
    <span class="nv">$item</span><span class="o">-&gt;</span><span class="n">title</span> <span class="o">=</span> <span class="n">preg_replace</span><span class="p">(</span><span class="s">&#39;/[^a-zA-Z0-9:!\.\-+=#@;()&amp;%$£\[\]\{\} ]/&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nv">$title</span><span class="p">);</span>
    <span class="nv">$item</span><span class="o">-&gt;</span><span class="nb">link</span> <span class="o">=</span> <span class="s">&#39;http://www.murga-linux.com/puppy/&#39;</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="nv">$table_row</span><span class="o">-&gt;</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;span.postdetails a[title=View latest post]&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">href</span><span class="p">);</span>
    <span class="nv">$item</span><span class="o">-&gt;</span><span class="n">description</span> <span class="o">=</span> <span class="n">trim</span><span class="p">(</span><span class="nv">$table_row</span><span class="o">-&gt;</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;td span.gensmall&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">plaintext</span><span class="p">);</span>
    <span class="sr">//i</span><span class="n">tem</span><span class="o">-&gt;</span><span class="n">descriptionTruncSize</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
    <span class="nv">$item</span><span class="o">-&gt;</span><span class="n">descriptionHtmlSyndicated</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span><span class="err">`</span>

    <span class="nv">$rss</span><span class="o">-&gt;</span><span class="n">addItem</span><span class="p">(</span><span class="nv">$item</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>





			</div><!-- #content -->
		</div><!-- #container -->

	</div><!-- #wrapper .hfeed -->
	
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	
	<script src="/js/main.js"></script>

	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-26149594-1']);
		_gaq.push(['_setDomainName', 'tombh.co.uk']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>

</body>
</html>
